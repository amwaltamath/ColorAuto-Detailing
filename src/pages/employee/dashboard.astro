---
import EmployeeLayout from '../../layouts/EmployeeLayout.astro';
import { ChatManager } from '../../components/features/ChatManager';
import { SchedulesTable } from '../../components/employee/SchedulesTable';
import { TeamsTable } from '../../components/employee/TeamsTable';
import { ProfileSettings } from '../../components/employee/ProfileSettings';
import { DashboardStats } from '../../components/employee/DashboardStats';
---

<EmployeeLayout title="Employee Dashboard">
  <div class="space-y-6 px-4 sm:px-0">
    
    <!-- Quick Stats -->
    <DashboardStats client:load />

    <!-- Tabs Navigation -->
    <div class="border-b border-slate-700 mb-6 md:mb-8 overflow-x-auto">
      <div class="flex space-x-4 md:space-x-8 min-w-min md:min-w-0">
        <button type="button" onclick="switchTab('schedules')" class="tab-button active pb-3 md:pb-4 text-xs md:text-base text-white font-semibold border-b-2 border-blue-500 cursor-pointer hover:text-slate-200 transition duration-200 whitespace-nowrap" data-tab="schedules">
          ğŸ“… Schedules
        </button>
        <button type="button" onclick="switchTab('teams')" class="tab-button pb-3 md:pb-4 text-xs md:text-base text-slate-400 font-semibold border-b-2 border-transparent cursor-pointer hover:text-slate-300 transition duration-200 whitespace-nowrap" data-tab="teams">
          ğŸ‘¥ Teams
        </button>
        <button type="button" onclick="switchTab('messages')" class="tab-button pb-3 md:pb-4 text-xs md:text-base text-slate-400 font-semibold border-b-2 border-transparent cursor-pointer hover:text-slate-300 transition duration-200 whitespace-nowrap" data-tab="messages">
          ğŸ’¬ Messages
        </button>
        <button type="button" onclick="switchTab('chat')" class="tab-button pb-3 md:pb-4 text-xs md:text-base text-slate-400 font-semibold border-b-2 border-transparent cursor-pointer hover:text-slate-300 transition duration-200 whitespace-nowrap" data-tab="chat">
          ğŸ§ Chat
        </button>
        <button type="button" onclick="switchTab('profile')" class="tab-button pb-3 md:pb-4 text-xs md:text-base text-slate-400 font-semibold border-b-2 border-transparent cursor-pointer hover:text-slate-300 transition duration-200 whitespace-nowrap" data-tab="profile">
          âš™ï¸ Profile
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div id="schedules" class="tab-content active">
      <div class="bg-slate-800 p-4 md:p-8 rounded-lg shadow-lg border border-slate-700">
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-white flex items-center">
          <span class="mr-2 md:mr-3">ğŸ“…</span> Your Service Schedules
        </h2>
        <div class="overflow-x-auto">
          <SchedulesTable client:load />
        </div>
      </div>
    </div>

    <div id="teams" class="tab-content hidden">
      <div class="bg-slate-800 p-4 md:p-8 rounded-lg shadow-lg border border-slate-700">
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-white flex items-center">
          <span class="mr-2 md:mr-3">ğŸ‘¥</span> Your Teams
        </h2>
        <div class="overflow-x-auto">
          <TeamsTable client:load />
        </div>
      </div>
    </div>

    <div id="messages" class="tab-content hidden">
      <div class="bg-slate-800 p-4 md:p-8 rounded-lg shadow-lg border border-slate-700">
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-white flex items-center">
          <span class="mr-2 md:mr-3">ğŸ’¬</span> Team Messages
        </h2>
        <div class="bg-slate-700/50 p-4 md:p-6 rounded border border-slate-600 text-center text-slate-400 text-sm md:text-base">
          <p>Team messaging feature coming soon</p>
        </div>
      </div>
    </div>

    <div id="chat" class="tab-content hidden">
      <div class="bg-slate-800 p-4 md:p-8 rounded-lg shadow-lg border border-slate-700">
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-white flex items-center">
          <span class="mr-2 md:mr-3">ğŸ§</span> Customer Chat Support
        </h2>
        <div class="overflow-x-auto">
          <ChatManager client:load />
        </div>
      </div>
    </div>

    <div id="profile" class="tab-content hidden">
      <div class="bg-slate-800 p-4 md:p-8 rounded-lg shadow-lg border border-slate-700">
        <h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6 text-white flex items-center">
          <span class="mr-2 md:mr-3">âš™ï¸</span> Profile Settings
        </h2>
        <ProfileSettings client:load />
      </div>
    </div>

  </div>
</EmployeeLayout>

<script>
  // Make switchTab available globally
  window.switchTab = function(tabName) {
    console.log('Switching to tab:', tabName);
    
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.classList.add('hidden');
      tab.classList.remove('active');
    });

    // Remove active state from all buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.classList.remove('text-white', 'border-blue-500');
      btn.classList.add('text-slate-400', 'border-transparent');
    });

    // Show selected tab
    const selectedTab = document.getElementById(tabName);
    if (selectedTab) {
      selectedTab.classList.remove('hidden');
      selectedTab.classList.add('active');
    }

    // Set active state on button
    const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
    if (activeButton) {
      activeButton.classList.remove('text-slate-400', 'border-transparent');
      activeButton.classList.add('text-white', 'border-blue-500');
    }

    // Store preference in localStorage
    localStorage.setItem('activeTab', tabName);
  };

  // Restore last active tab on page load
  document.addEventListener('DOMContentLoaded', function() {
    const lastTab = localStorage.getItem('activeTab') || 'schedules';
    window.switchTab(lastTab);
  });
</script>

<style>
  .tab-button {
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    cursor: pointer;
    position: relative;
    display: inline-block;
  }
  
  .tab-button:focus {
    outline: none;
  }
  
  .tab-button:active {
    transform: scale(0.98);
  }
  
  .tab-content {
    transition: opacity 0.3s ease;
  }
  
  .tab-content.active {
    opacity: 1;
    visibility: visible;
  }
  
  .tab-content.hidden {
    display: none;
    opacity: 0;
    visibility: hidden;
  }
</style>
